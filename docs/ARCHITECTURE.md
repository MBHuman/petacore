# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PetaCore

## –û–±–∑–æ—Ä

PetaCore - —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –°–£–ë–î —Å MVCC (Multi-Version Concurrency Control), —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è CP –º–æ–¥–µ–ª—å (Consistency + Partition tolerance) –∏–∑ CAP —Ç–µ–æ—Ä–µ–º—ã. –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ ETCD –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ MVCC –∫–µ—à–∞ –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è.

## –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:

- **–ß—Ç–µ–Ω–∏–µ**: –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ MVCC –∫–µ—à–∞ (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã, eventual consistency)
- **–ó–∞–ø–∏—Å—å**: —á–µ—Ä–µ–∑ ETCD —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –≤—Å–µ —É–∑–ª—ã (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, strong consistency)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—Å—Ç–∏—á—å **–ø–æ—á—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á—Ç–µ–Ω–∏—è** –ø—Ä–∏ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏** –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Client Application                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   DistributedStorage API                     ‚îÇ
‚îÇ  - RunTransaction(func(tx))                                  ‚îÇ
‚îÇ  - IsolationLevel: RC / SI                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                          ‚îÇ
           ‚îÇ READ                     ‚îÇ WRITE
           ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Local MVCC     ‚îÇ         ‚îÇ   Synchronizer   ‚îÇ
‚îÇ   Cache          ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   WriteThrough   ‚îÇ
‚îÇ                  ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  - Skip List     ‚îÇ                  ‚îÇ
‚îÇ  - Versions      ‚îÇ                  ‚îÇ Watch
‚îÇ  - Logical Clock ‚îÇ                  ‚ñº
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                             ‚îÇ   ETCD Cluster   ‚îÇ
                             ‚îÇ  (Source of      ‚îÇ
                             ‚îÇ   Truth)         ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                             ‚ñº                 ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Node 2 MVCC  ‚îÇ  ‚îÇ  Node 3 MVCC  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. DistributedStorage

**–†–æ–ª—å**: –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

**–§—É–Ω–∫—Ü–∏–∏**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É MVCC –∫–µ—à–µ–º –∏ ETCD
- –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏

**–ö–æ–¥**:
```go
ds := storage.NewDistributedStorage(kvStore, core.ReadCommitted)
ds.Start() // –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

ds.RunTransaction(func(tx *storage.DistributedTransaction) error {
    value, _ := tx.Read("key")  // –ë—ã—Å—Ç—Ä–æ - –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∞
    tx.Write("key", "value")     // –ú–µ–¥–ª–µ–Ω–Ω–æ - —á–µ—Ä–µ–∑ ETCD
    return nil
})
```

### 2. MVCC Cache (Local)

**–†–æ–ª—å**: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**: Skip List –¥–ª—è O(log n) –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ—Ä—Å–∏—è–º.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –•—Ä–∞–Ω–∏—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (HLC)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- –ß—Ç–µ–Ω–∏–µ: **4,622,009 ops/sec** (216 –Ω—Å)
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: **35,693,244 ops/sec** (28 –Ω—Å)
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏

### 3. Synchronizer

**–†–æ–ª—å**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É ETCD –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º MVCC –∫–µ—à–µ–º.

**–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**:

#### Initial Sync
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —É–∑–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ ETCD –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à:
```go
entries := kvStore.GetAll(ctx, "")
for _, entry := range entries {
    mvcc.Write(entry.Key, entry.Value, entry.Version)
}
```

#### Watch Loop
–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ ETCD –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–µ—à—É:
```go
watchChan := kvStore.Watch(ctx, "", lastRevision)
for event := range watchChan {
    mvcc.Write(event.Key, event.Value, event.Version)
}
```

#### WriteThrough
–ü—Ä–∏ –∑–∞–ø–∏—Å–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ—Ç –≤ ETCD, –ø–æ—Ç–æ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à:
```go
version := logicalClock.Inc()
kvStore.Put(ctx, key, value, version)  // –ú–µ–¥–ª–µ–Ω–Ω–æ
mvcc.Write(key, value, version)         // –ë—ã—Å—Ç—Ä–æ
```

### 4. ETCD (Source of Truth)

**–†–æ–ª—å**: –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

**–ü–æ—á–µ–º—É ETCD**:
- ‚úÖ Strong consistency (Raft –∫–æ–Ω—Å–µ–Ω—Å—É—Å)
- ‚úÖ Watch API –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å (Kubernetes, –∏ —Ç.–¥.)

**Trade-offs**:
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (~5 –º—Å –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é)
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π throughput –∑–∞–ø–∏—Å–∏ (~200-500 ops/sec)
- ‚úÖ –ù–æ —ç—Ç–æ acceptable –¥–ª—è CP –º–æ–¥–µ–ª–∏

### 5. Logical Clock (HLC)

**–†–æ–ª—å**: –ì–∏–±—Ä–∏–¥–Ω—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–µ –≤–µ—Ä—Å–∏–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ —á–µ—Ä–µ–∑ ETCD

**–ü—Ä–∏–º–µ—Ä**:
```go
version1 := clock.Inc()     // 1765649929871731945
version2 := clock.Inc()     // 1765649929871731946
clock.Recv(otherNodeTime)   // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```

## –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏

### Read Committed (RC)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ committed –¥–∞–Ω–Ω—ã–µ
- –ö–∞–∂–¥–æ–µ —á—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
- –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 188.0 tx/sec

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

```go
tx.Begin()
v1 := tx.Read("key")  // –í–µ—Ä—Å–∏—è 100
// –î—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±–Ω–æ–≤–∏–ª–∞ –∫–ª—é—á –¥–æ –≤–µ—Ä—Å–∏–∏ 101
v2 := tx.Read("key")  // –í–µ—Ä—Å–∏—è 101 (–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ!)
```

### Snapshot Isolation (SI)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π snapshot –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞
- –í—Å–µ —á—Ç–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù–µ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 202.6 tx/sec

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å —á—Ç–µ–Ω–∏–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

```go
tx.Begin() // Snapshot –Ω–∞ –≤–µ—Ä—Å–∏–∏ 100
v1 := tx.Read("key")  // –í–µ—Ä—Å–∏—è 100
// –î—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±–Ω–æ–≤–∏–ª–∞ –∫–ª—é—á –¥–æ –≤–µ—Ä—Å–∏–∏ 101
v2 := tx.Read("key")  // –í–µ—Ä—Å–∏—è 100 (snapshot!)
```

**–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ**: SI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (~8% –±—ã—Å—Ç—Ä–µ–µ), —Ç–∞–∫ –∫–∞–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —á—Ç–µ–Ω–∏–∏.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –°–£–ë–î

| –û–ø–µ—Ä–∞—Ü–∏—è | –õ–æ–∫–∞–ª—å–Ω–∞—è | –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----------|----------------|---------|
| **–ó–∞–ø–∏—Å—å** | 7.8 Œºs | 4.9 ms | **629x –º–µ–¥–ª–µ–Ω–Ω–µ–µ** |
| **–ß—Ç–µ–Ω–∏–µ** | 126 ns | 216 ns | **1.7x –º–µ–¥–ª–µ–Ω–Ω–µ–µ** |
| **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å** | 574 ns | 989 Œºs | **1723x –º–µ–¥–ª–µ–Ω–Ω–µ–µ** |
| **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** | 21 ns | 28 ns | **1.3x –º–µ–¥–ª–µ–Ω–Ω–µ–µ** |

### –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã

#### 1. –ß—Ç–µ–Ω–∏–µ –ø–æ—á—Ç–∏ –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ–µ! üöÄ

```
–õ–æ–∫–∞–ª—å–Ω–æ–µ:        126 ns   (7.9M ops/sec)
–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ:   216 ns   (4.6M ops/sec)
–î–µ–≥—Ä–∞–¥–∞—Ü–∏—è:       1.7x     (–æ—Ç–ª–∏—á–Ω–æ!)
```

**–í—ã–≤–æ–¥**: –õ–æ–∫–∞–ª—å–Ω—ã–π MVCC –∫–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ. –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã.

#### 2. –ó–∞–ø–∏—Å—å –º–µ–¥–ª–µ–Ω–Ω–∞—è, –Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è üêå

```
–õ–æ–∫–∞–ª—å–Ω–æ–µ:        7.8 Œºs   (128K ops/sec)
–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ:   4.9 ms   (204 ops/sec)
–î–µ–≥—Ä–∞–¥–∞—Ü–∏—è:       629x     (–æ–∂–∏–¥–∞–µ–º–æ)
```

**–í—ã–≤–æ–¥**: –≠—Ç–æ trade-off CP –º–æ–¥–µ–ª–∏. –ù–æ 200 ops/sec –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–Ω–æ–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

#### 3. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ üìà

```
–û–¥–∏–Ω–æ—á–Ω–æ–µ:        216 ns   (4.6M ops/sec)
–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ:     28 ns    (35.7M ops/sec)
–£—Å–∫–æ—Ä–µ–Ω–∏–µ:        7.7x     (–Ω–∞ 16 —è–¥—Ä–∞—Ö)
```

**–í—ã–≤–æ–¥**: –û—Ç–ª–∏—á–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö.

#### 4. –ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã üì¶

```
BatchSize=1:      4.8 ms   (207 writes/sec)
BatchSize=10:     47 ms    (210 writes/sec) - –ø–æ—á—Ç–∏ 10x —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ!
BatchSize=50:     236 ms   (212 writes/sec)
BatchSize=100:    490 ms   (204 writes/sec)
```

**–í—ã–≤–æ–¥**: –ü—Ä–∏ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –∞–º–æ—Ä—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è. Throughput –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º.

#### 5. Hot Key - –æ–∂–∏–¥–∞–µ–º–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ üî•

```
Hot Key:          950 Œºs   (1053 ops/sec)
```

**–í—ã–≤–æ–¥**: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ –æ–¥–∏–Ω –∫–ª—é—á –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ ETCD. –ù–æ –≤—Å—ë –µ—â—ë >1000 ops/sec.

#### 6. Read-Heavy –Ω–∞–≥—Ä—É–∑–∫–∞ - —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ üí™

```
90% —á—Ç–µ–Ω–∏–π:       97 Œºs    (10,302 ops/sec)
90% –∑–∞–ø–∏—Å–µ–π:      874 Œºs   (1,144 ops/sec)
```

**–í—ã–≤–æ–¥**: –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è read-heavy workloads.

### –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

```
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è:      3.0 ms
–°—Ä–µ–¥–Ω—è—è:          4.8 ms
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è:     13.1 ms
```

**–í—ã–≤–æ–¥**: –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è, –±–µ–∑ –≤—ã–±—Ä–æ—Å–æ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è real-time –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –æ–±—ã—á–Ω—ã–º–∏ –°–£–ë–î

### 1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è üìä

**–û–±—ã—á–Ω–∞—è –°–£–ë–î**:
```
Master-Slave: –ß—Ç–µ–Ω–∏—è –∏–¥—É—Ç –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏, –Ω–æ –µ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
Sharding: –°–ª–æ–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
```

**PetaCore**:
```
–î–æ–±–∞–≤—å —É–∑–µ–ª ‚Üí –ü–æ–ª—É—á–∏ N-–∫—Ä–∞—Ç–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ throughput —á—Ç–µ–Ω–∏—è
–í—Å–µ —É–∑–ª—ã eventually consistent —á–µ—Ä–µ–∑ ETCD watch
```

**–ü—Ä–∏–º–µ—Ä**:
```
1 —É–∑–µ–ª:  4.6M reads/sec
3 —É–∑–ª–∞:  ~13.8M reads/sec (–ª–∏–Ω–µ–π–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
10 —É–∑–ª–æ–≤: ~46M reads/sec
```

### 2. Strong Consistency –∑–∞–ø–∏—Å–∏ üîí

**–û–±—ã—á–Ω–∞—è –°–£–ë–î**:
```
PostgreSQL/MySQL: Strong consistency, –Ω–æ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è
MongoDB: Weak consistency –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
Cassandra: Eventually consistent, –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
```

**PetaCore**:
```
ETCD Raft –∫–æ–Ω—Å–µ–Ω—Å—É—Å: Strong consistency
–í—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø–∏—Å–µ–π
–ù–µ—Ç split-brain –ø—Ä–æ–±–ª–µ–º
```

### 3. MVCC –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ üö´üîê

**–û–±—ã—á–Ω–∞—è –°–£–ë–î**:
```
Readers –±–ª–æ–∫–∏—Ä—É—é—Ç writers (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
Deadlocks –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
Contention –Ω–∞ –≥–æ—Ä—è—á–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
```

**PetaCore**:
```
Readers –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç writers
Writers –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç readers
Lock-free —á—Ç–µ–Ω–∏–µ –∏–∑ MVCC –∫–µ—à–∞
```

### 4. –ü—Ä–æ—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å üõ†Ô∏è

**–û–±—ã—á–Ω–∞—è –°–£–ë–î**:
```
–°–ª–æ–∂–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (master-slave, multi-master)
Backup/restore —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–ø–ª–∏–∫, shards
```

**PetaCore**:
```
Stateless —É–∑–ª—ã (–≤–µ—Å—å state –≤ ETCD)
–£–∑–µ–ª —É–ø–∞–ª? –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ –Ω–æ–≤—ã–π
ETCD —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é
```

### 5. –ì–∏–±–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ üéöÔ∏è

**–û–±—ã—á–Ω–∞—è –°–£–ë–î**:
```
–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏
–°–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
–ß–∞—Å—Ç–æ read committed –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
```

**PetaCore**:
```
Read Committed: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–≤–µ–∂–µ—Å—Ç—å
Snapshot Isolation: –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ —á—Ç–µ–Ω–∏—è
–ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å per-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PetaCore

### ‚úÖ –ò–¥–µ–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏

1. **Read-Heavy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   - –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (–ø—Ä–æ—Ñ–∏–ª–∏, –ª–µ–Ω—Ç–∞)
   - E-commerce –∫–∞—Ç–∞–ª–æ–≥–∏
   - CMS —Å–∏—Å—Ç–µ–º—ã
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é

2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**
   - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - Multi-region deployment
   - Edge computing
   - IoT —Å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–µ–π

3. **Strong Consistency –∫—Ä–∏—Ç–∏—á–Ω–∞**
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è (inventory)
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ê—É–∫—Ü–∏–æ–Ω—ã

4. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–∞—Å—Ç—É—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ
   - –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å
   - –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è

### ‚ö†Ô∏è –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è

1. **Write-Heavy –Ω–∞–≥—Ä—É–∑–∫–∞**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (>1000 writes/sec)
   - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ú–µ—Ç—Ä–∏–∫–∏ / –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
   - **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –∏–ª–∏ batch writes

2. **–ù–∏–∑–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏**
   - High-frequency trading
   - Real-time gaming leaderboards
   - Live betting
   - **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –°–£–ë–î + async sync

3. **–°–ª–æ–∂–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã**
   - OLAP –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - –û—Ç—á—ë—Ç—ã —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
   - **–†–µ—à–µ–Ω–∏–µ**: PetaCore - —ç—Ç–æ KV store, –Ω–µ SQL

4. **–û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è**
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
   - –ë–æ–ª—å—à–∏–µ JSON –¥–æ–∫—É–º–µ–Ω—Ç—ã (>1MB)
   - **–†–µ—à–µ–Ω–∏–µ**: ETCD –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 1.5MB per key

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

### vs PostgreSQL

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | PostgreSQL | PetaCore |
|----------------|------------|----------|
| –ß—Ç–µ–Ω–∏–µ | 50K-100K ops/sec | 4.6M ops/sec (local) |
| –ó–∞–ø–∏—Å—å | 10K-50K ops/sec | 200 ops/sec |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è | –°–ª–æ–∂–Ω–æ (replicas) | –¢—Ä–∏–≤–∏–∞–ª—å–Ω–æ (add nodes) |
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | Strong | Strong |
| **–í—ã–≤–æ–¥** | –î–ª—è write-heavy | –î–ª—è read-heavy |

### vs MongoDB

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | MongoDB | PetaCore |
|----------------|---------|----------|
| –ß—Ç–µ–Ω–∏–µ | 100K-500K ops/sec | 4.6M ops/sec |
| –ó–∞–ø–∏—Å—å | 10K-50K ops/sec | 200 ops/sec |
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | Eventually | Strong |
| Sharding | –¢—Ä–µ–±—É–µ—Ç—Å—è | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è |
| **–í—ã–≤–æ–¥** | Flexible, –Ω–æ —Å–ª–æ–∂–Ω—ã–π | Simple, –Ω–æ write-limited |

### vs Redis (with AOF persistence)

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Redis | PetaCore |
|----------------|-------|----------|
| –ß—Ç–µ–Ω–∏–µ | 100K ops/sec | 4.6M ops/sec |
| –ó–∞–ø–∏—Å—å | 80K ops/sec | 200 ops/sec |
| –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | RDB/AOF (async) | Sync —á–µ—Ä–µ–∑ ETCD |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å | Redis Cluster | Native |
| **–í—ã–≤–æ–¥** | –ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–µ–Ω–µ–µ –Ω–∞–¥—ë–∂–Ω–æ | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –Ω–∞–¥—ë–∂–Ω–µ–µ |

### vs Cassandra

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Cassandra | PetaCore |
|----------------|-----------|----------|
| –ß—Ç–µ–Ω–∏–µ | 10K-100K ops/sec | 4.6M ops/sec |
| –ó–∞–ø–∏—Å—å | 10K-50K ops/sec | 200 ops/sec |
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | Tunable (weak-strong) | Always strong |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | –û—Ç–ª–∏—á–Ω–æ | –û—Ç–ª–∏—á–Ω–æ (—á—Ç–µ–Ω–∏–µ) |
| **–í—ã–≤–æ–¥** | Write-friendly, —Å–ª–æ–∂–Ω—ã–π | Read-optimized, –ø—Ä–æ—Å—Ç–æ–π |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ trade-offs

### 1. –ü–æ—á–µ–º—É ETCD, –∞ –Ω–µ Raft –Ω–∞–ø—Ä—è–º—É—é?

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ETCD**:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Raft
- ‚úÖ Watch API –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Trade-offs**:
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ETCD
- ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å ETCD –Ω–∞ –ª—é–±—É—é –¥—Ä—É–≥—É—é CP —Å–∏—Å—Ç–µ–º—É (Consul, ZooKeeper).

### 2. –ü–æ—á–µ–º—É –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à, –∞ –Ω–µ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ ETCD?

**–ë–µ–∑ –∫–µ—à–∞**:
```
–ß—Ç–µ–Ω–∏–µ –∏–∑ ETCD: ~1-5 ms (network + ETCD)
Throughput: 1000-5000 reads/sec
```

**–° –∫–µ—à–µ–º**:
```
–ß—Ç–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞: 216 ns (memory)
Throughput: 4.6M reads/sec
```

**–í—ã–∏–≥—Ä—ã—à**: 2300x –≤ throughput, 23000x –≤ latency!

### 3. –ü–æ—á–µ–º—É Skip List, –∞ –Ω–µ B-Tree?

**Skip List**:
- ‚úÖ –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –õ—É—á—à–µ –¥–ª—è concurrent access
- ‚úÖ Lock-free –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏

**B-Tree**:
- ‚úÖ –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ balancing
- ‚ö†Ô∏è –•—É–∂–µ –¥–ª—è concurrent access

### 4. –ü–æ—á–µ–º—É –Ω–µ distributed transactions (2PC)?

**2PC –ø—Ä–æ–±–ª–µ–º—ã**:
- ‚ö†Ô∏è –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª
- ‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä - single point of failure
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞
- ‚úÖ ETCD –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å

**Trade-off**: –ù–µ—Ç multi-key atomic updates –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (–Ω–æ —ç—Ç–æ —Ä–µ–¥–∫–æ –Ω—É–∂–Ω–æ).

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

1. **Batch writes**:
```go
// –ü–ª–æ—Ö–æ: 10 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
for i := 0; i < 10; i++ {
    ds.RunTransaction(func(tx) {
        tx.Write(key, value)
    })
}

// –•–æ—Ä–æ—à–æ: 1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å 10 –∑–∞–ø–∏—Å—è–º–∏
ds.RunTransaction(func(tx) {
    for i := 0; i < 10; i++ {
        tx.Write(key, value)
    }
})
```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Read Committed –¥–ª—è read-heavy**:
```go
ds := NewDistributedStorage(kvStore, core.ReadCommitted)
```

3. **–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ hot keys**:
```go
// –ü–ª–æ—Ö–æ: –≤—Å–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É—é—Ç –æ–¥–∏–Ω —Å—á—ë—Ç—á–∏–∫
tx.Write("global_counter", value)

// –•–æ—Ä–æ—à–æ: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
tx.Write(fmt.Sprintf("counter_%d", nodeID), value)
```

4. **–õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**:
```go
// –ß–∏—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–æ—Ç —É–∑–µ–ª —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
// ETCD watch –æ–±–µ—Å–ø–µ—á–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
```

### –î–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

1. **ETCD –Ω–∞ SSD –¥–∏—Å–∫–∞—Ö**
2. **ETCD –∫–ª–∞—Å—Ç–µ—Ä –±–ª–∏–∑–∫–æ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é** (low latency network)
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ETCD –º–µ—Ç—Ä–∏–∫**:
   - Latency
   - Throughput
   - Disk I/O

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Write-behind cache**:
   - –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç—å
   - Batch flush –≤ ETCD
   - –ö–æ–º–ø—Ä–æ–º–∏—Å—Å: eventual consistency –∑–∞–ø–∏—Å–∏

2. **Partitioning/Sharding**:
   - –†–∞–∑–Ω—ã–µ ETCD –∫–ª–∞—Å—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö key spaces
   - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ throughput –∑–∞–ø–∏—Å–∏

3. **Read-your-writes**:
   - –ì–∞—Ä–∞–Ω—Ç–∏—è —á—Ç–æ —É–∑–µ–ª –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏
   - Tracking pending writes

4. **Compression**:
   - –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ ETCD
   - Trade-off: CPU vs Network

5. **TTL –∏ garbage collection**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
   - –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

PetaCore - —ç—Ç–æ **—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –°–£–ë–î —Å —á—ë—Ç–∫–∏–º–∏ trade-offs:

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã ‚úÖ
- **–§–µ–Ω–æ–º–µ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è** (4.6M ops/sec)
- **Strong consistency** —á–µ—Ä–µ–∑ ETCD
- **–ü—Ä–æ—Å—Ç–æ–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (–ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å —É–∑–ª—ã)
- **MVCC –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**
- **–ü—Ä–æ—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å** (stateless —É–∑–ª—ã)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚ö†Ô∏è
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π throughput –∑–∞–ø–∏—Å–∏** (~200 ops/sec per transaction)
- **–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è write-heavy** –Ω–∞–≥—Ä—É–∑–∫–∏
- **Key-Value –º–æ–¥–µ–ª—å** (–Ω–µ SQL)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç ETCD**

### –ò–¥–µ–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ üéØ
- Read-heavy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (90%+ —á—Ç–µ–Ω–∏–π)
- –ù—É–∂–Ω–∞ strong consistency
- –ù—É–∂–Ω–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ò—Ç–æ–≥**: PetaCore **–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ** –æ–±—ã—á–Ω—ã—Ö –°–£–ë–î –¥–ª—è —Å–≤–æ–µ–≥–æ use case (read-heavy + strong consistency), –Ω–æ **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è universal solution**. –í—ã–±–∏—Ä–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥ –∑–∞–¥–∞—á—É!
